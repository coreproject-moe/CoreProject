{% load static %}

<link rel="stylesheet" href="{% static 'css/navbar/navbar.css' %}" />

<nav
    class="navbar container"
    role="navigation"
    aria-label="main navigation"
    x-cloak
    x-data="{ 
            open: false,
            button_turned: false,
        }"
>
    <div
        class="navbar-brand is-clipped"
        x-init="
            () => {
                switch ($store.is_mobile) {
                    case true : {
                        open = false;
                        button_turned = true;
                        break;            
                    }
                    case false : {
                        open = true;
                        break;
                    }
                }
            }
        "
    >
        <a class="navbar-item is-clickable" href="https://bulma.io">
            <img
                src="{% static 'images/logos/logo.avif' %}"
                width="112"
                height="28"
            />
        </a>

        <a
            role="button "
            class="navbar-burger is-clickable"
            style="margin-top: -0.5em"
            aria-label="menu"
            aria-expanded="false"
            :class="open ? 'is-active' : ''"
            @click="open = !open"
        >
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div
        class="navbar-menu is-active"
        x-init="
            $watch('$store.is_mobile', value => {
                switch ( value ) {
                    case true : {
                        open = true;
                        break;
                    }
                    case false : {
                        open = false;
                        break;
                    }
                }
            })
                
        "
        x-show="open"
        x-collapse
    >
        <div x-show="open" x-transition x-transition.delay.50ms>
            <div
                class="navbar-start mb-3"
                :class="$store.is_mobile ? 'is-flex is-flex-direction-row is-justify-content-center' : ''"
            >
                <button
                    class="navbar-item button is-ghost is-rounded ml-1 is-unselectable"
                    x-init="
                        () => {
                            if ('{{ request.path }}' == '/') {
                                $el.classList.add('hover')
                            }
                        }
                    "
                    @mouseenter="
                        () => {
                            anime({
                                targets: '.animejs__home__icon',
                                color: '#e50000',
                            })
                        }
                    "
                    @mouseleave="
                        () => {
                            anime({
                                targets: '.animejs__home__icon',
                                color: '#d9d9d9',
                            })
                        }
                    "
                    @click.prevent="
                        () => {
                            window.location = '/'
                        }
                    "
                >
                    <ion-icon
                        name="home-sharp"
                        class="animejs__home__icon"
                    ></ion-icon>
                    <p :class="$store.is_mobile ? 'pt-2 nav-icon-button' : ''">
                        &nbsp; Home
                    </p>
                </button>
                <button
                    class="navbar-item button is-ghost is-rounded ml-2 is-unselectable"
                    x-init="
                        () => {
                            const string = '{{ request.path }}';
                            
                            if ( string.includes('blog') ) {
                                $el.classList.add('hover')
                            }
                        }
                    "
                    @mouseenter="
                        () => {
                            anime({
                                targets: '.animejs__school__icon',
                                color: '#e50000',
                            })
                        }
                    "
                    @mouseleave="
                        () => {
                            anime({
                                targets: '.animejs__school__icon',
                                color: '#d9d9d9',
                            })
                        }
                    "
                    @click.prevent="
                        () => {
                            window.location = '/blog/'
                        }
                    "
                >
                    <ion-icon
                        name="school-sharp"
                        class="animejs__school__icon"
                    ></ion-icon>
                    <p :class="$store.is_mobile ? 'pt-2 nav-icon-button' : ''">
                        &nbsp; Blog
                    </p>
                </button>
                <button
                    class="navbar-item button is-ghost is-rounded ml-2 is-unselectable"
                    x-init="
                            () => {
                                if ('{{ request.path }}' === '/projects/') {
                                    $el.classList.add('hover')
                                }
                            }
                        "
                    @mouseenter="
                        () => {
                            anime({
                                targets: '.animejs__projects__icon',
                                color: '#e50000',
                            })
                        }
                    "
                    @mouseleave="
                        () => {
                            anime({
                                targets: '.animejs__projects__icon',
                                color: '#d9d9d9',
                            })
                        }
                    "
                >
                    <ion-icon
                        name="extension-puzzle-sharp"
                        class="animejs__projects__icon"
                    ></ion-icon>
                    <p :class="$store.is_mobile ? 'pt-2 nav-icon-button' : ''">
                        &nbsp; Projects
                    </p>
                </button>
            </div>
        </div>

        <div class="navbar-end">
            <div
                class="navbar-item"
                :class="$store.is_mobile ? 'is-flex is-flex-direction-row is-justify-content-center pt-6' : ''"
            >
                <a
                    href="https://github.com/baseplate-admin/animeCore/"
                    class="is-rounded is-dark animejs__github__button is-clickable"
                    :class="$store.is_mobile ? 'is-hidden ': ''"
                    x-effect="
                        () => {
                            switch ( button_turned ) {
                                case true : {
                                    anime({
                                        targets: '.animejs__github__button',
                                        translateX: 0,
                                        easing: 'easeOutSine',
                                        duration: 150,
                                        opacity: 1 ,
                                        scale: 1,
                                    })
                                    break;
                                }
                                case false : {
                                    anime({
                                        targets: '.animejs__github__button',
                                        translateX: 40,
                                        easing: 'easeOutSine',
                                        duration: 150,
                                        opacity: 0,
                                        scale: 0.2,
                                    })
                                    break;
                                }
                            }
                        }
                    "
                    @mouseenter="
                            () => {
                                anime({
                                    targets: '.animejs__logo__github',
                                    color: 'hsl(0, 0%, 100%)',
                                })
                                anime({
                                    targets: '.animejs__github__button',
                                    scale: 1.3,
                                })
                            }
                        "
                    @mouseleave="
                        () => {
                            anime({
                                targets: '.animejs__logo__github',
                                color: 'hsl(0, 0%, 80%)',
                            })
                            anime({
                                targets: '.animejs__github__button',
                                scale: 1,
                            })
                        }
                    "
                    x-init="
                        () => {
                            tippy('.animejs__github__button', {
                                content: 'Github',
                            })
                        }
                    "
                >
                    <ion-icon
                        class="animejs__logo__github"
                        :class="$store.is_mobile ? 'is-position-absolute' : ''"
                        style="width: 100%; height: 100%"
                        name="logo-github"
                        x-init="
                            () => {
                                anime({
                                    targets: '.animejs__logo__github',
                                    color: 'hsl(0, 0%, 80%)',
                                    scale: 0.6,
                                })
                                
                            }
                        "
                    ></ion-icon>
                </a>

                <a
                    style="z-index: 1000000"
                    class="is-rounded is-dark animejs__arrow__button is-clickable"
                    :class="
                        $store.is_mobile ? 'is-hidden' : ''
                    "
                    x-init="
                    {# Button is not inited | Side effect migration #}
                        $watch('button_turned', value => {
                                switch ( button_turned ) {
                                    case true : {
                                        anime({
                                            targets: '.animejs__arrow__back',
                                            rotate: 180,
                                        })
                                        break;
                                    }
                                    case false : {
                                        anime({
                                            targets: '.animejs__arrow__back',
                                            rotate: 0,
                                        })
                                        break;
                                    }
                                }
                            }
                        )
                    "
                    @click.prevent="
                        () => {
                            anime({
                                targets: '.animejs__arrow__back',
                                rotate: button_turned ? 0 : 180,
                            })
                            button_turned = !button_turned;
                        }
                    "
                    @mouseenter="
                        () => {
                            anime({
                                targets: '.animejs__arrow__back',
                                color: '#e50000',
                            })
                            anime({
                                targets: '.animejs__arrow__button',
                                scale: 1.2,
                            })
                        }
                    "
                    @mouseleave="
                        () => {
                            anime({
                                targets: '.animejs__arrow__back',
                                color: 'hsl(0, 0%, 80%)',
                            })
                            anime({
                                targets: '.animejs__arrow__button',
                                scale: 1,
                            })
                        }
                    "
                >
                    <ion-icon
                        class="animejs__arrow__back"
                        name="arrow-back-outline"
                        style="width: 100%; height: 100%"
                        x-init="
                            () => {
                                anime({
                                    targets: '.animejs__arrow__back',
                                    easing: 'linear',
                                    duration: 100,
                                    color: 'hsl(0, 0%, 80%)',
                                    scale: 0.6,
                                })                              
                            }
                        "
                    ></ion-icon>
                </a>
            </div>
            <template x-if="!$store.is_mobile">
                {% if request.user.is_authenticated %}
                <figure class="image is-48x48 pt-2 pl-2">
                    <img
                        class="is-rounded"
                        src="{% static 'core/images/placeholder.png' %}"
                    />
                </figure>
                {% else %}
                <div class="navbar-item">
                    <div class="buttons">
                        <button
                            class="button is-ghost is-rounded"
                            @click.prevent="
                                () => {
                                    window.location = '/authentication/login/?next={{ request.path }}'
                                }
                            "
                        >
                            Log in
                        </button>
                    </div>
                </div>
                {% endif %}
            </template>
            <template x-if="$store.is_mobile">
                <div>{# TODO ADD ICON #}</div>
            </template>
        </div>
    </div>
</nav>
